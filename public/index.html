<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Zetsu Sora Aggregator</title>

<style>
  body {
    margin: 0;
    background: #000;
    font-family: 'Poppins', sans-serif;
    color: #fff;
  }

  /* Puffy Crypto Panel */
  #devPanel {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    padding: 1rem;
    display: flex;
    flex-wrap: wrap;
    gap: 0.75rem;
    align-items: center;

    background: linear-gradient(135deg, #0a0f12, #0f1b2a);
    border-bottom: 2px solid rgba(0,255,255,0.18);
    box-shadow: 0 8px 40px rgba(0, 255, 255, 0.15);

    z-index: 999999;
  }

  #devPanel input {
    padding: 0.5rem 0.75rem;
    border-radius: 14px;
    border: 1px solid rgba(0,255,255,0.25);
    background: rgba(255,255,255,0.05);
    color: #c8faff;
    width: 280px;
    outline: none;
  }

  #devPanel button {
    padding: 0.5rem 0.9rem;
    border-radius: 14px;
    border: none;
    background: rgba(0,255,255,0.18);
    color: #c8faff;
    cursor: pointer;
    font-weight: 500;
    transition: 0.15s;
    box-shadow: 0 0 10px rgba(0,255,255,0.15);
  }

  #devPanel button:hover {
    background: rgba(0,255,255,0.35);
    transform: translateY(-2px);
  }

  #z-tab-buttons button {
    padding: 0.4rem 0.7rem;
    border-radius: 14px;
    border: none;
    background: rgba(0,255,255,0.12);
    color: #aef8ff;
    cursor: pointer;
    font-size: 0.85rem;
    box-shadow: 0 0 8px rgba(0,255,255,0.15);
    transition: 0.15s;
  }

  #z-tab-buttons button:hover {
    background: rgba(0,255,255,0.28);
  }

  /* iFrame container */
  #tabContainer {
    position: absolute;
    top: 82px;
    left: 0;
    width: 100%;
    height: calc(100% - 82px);
    background: #000;
    overflow: hidden;
  }

  iframe {
    width: 100%;
    height: 100%;
    border: none;
    display: none;
  }
</style>
</head>

<body>

<!-- ===== PANEL ===== -->
<div id="devPanel">
  <label>ðŸ”— URL:
    <input id="z-url-input" type="text" placeholder="https://example.com">
  </label>

  <button id="z-open-tab">ðŸ§¿ Load Tab</button>
  <button id="z-scrape">ðŸ§© Scrape</button>
  <button id="z-clear">ðŸ—‘ Clear</button>

  <span style="margin-left:auto;">ðŸ§© Tabs:</span>
  <div id="z-tab-buttons" style="display:flex;gap:0.5rem;"></div>
</div>

<!-- ===== TAB VIEW ===== -->
<div id="tabContainer"></div>


<!-- ====== ORIGINAL JS (unchanged logic) ====== -->
<script>
// Zetsu Sora Aggregator â€” Phase 3 (Fixed)
// SAME LOGIC you already had

let tabs = {};
let activeTab = null;

function switchTab(id) {
  Object.keys(tabs).forEach(key => {
    tabs[key].style.display = (key === id ? "block" : "none");
  });
  activeTab = id;
}

document.getElementById('z-open-tab').onclick = () => {
  const url = document.getElementById('z-url-input').value.trim();
  if (!url) return alert("Enter a URL first.");

  const tabId = `tab-${Date.now()}`;

  const iframe = document.createElement('iframe');
  iframe.src = url;
  document.getElementById('tabContainer').appendChild(iframe);

  tabs[tabId] = iframe;

  const tabBtn = document.createElement('button');
  tabBtn.textContent = new URL(url).hostname;
  tabBtn.onclick = () => switchTab(tabId);
  document.getElementById('z-tab-buttons').appendChild(tabBtn);

  switchTab(tabId);
};

document.getElementById('z-clear').onclick = () => {
  document.getElementById('tabContainer').innerHTML = "";
  tabs = {};
  activeTab = null;
  document.getElementById('z-tab-buttons').innerHTML = "";
};

document.getElementById('z-scrape').onclick = () => {
  if (!activeTab || !tabs[activeTab]) {
    alert("No active tab loaded.");
    return;
  }

  const iframe = tabs[activeTab];

  let doc;
  try {
    doc = iframe.contentWindow.document;
  } catch (err) {
    console.error("âŒ Cross-origin block:", err);
    alert("âŒ Cannot scrape this page (cross-origin protection).");
    return;
  }

  const rows = doc.querySelectorAll('table tr');
  const out = [];

  rows.forEach(row => {
    const cells = row.querySelectorAll('td');
    if (cells.length >= 3) {
      out.push({
        name: cells[0].innerText.trim(),
        rank: cells[1].innerText.trim(),
        views: cells[2].innerText.trim(),
        source: new URL(iframe.src).hostname,
        fetched_at: new Date().toISOString()
      });
    }
  });

  console.log("âœ… Zetsu Scrape JSON:", out);
  alert(`âœ… Scraped ${out.length} items. Check console for JSON.`);
};
</script>

</body>
</html>
